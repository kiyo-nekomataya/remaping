/**
 *
 *	node.js下で単独で使用可能なユーティリティー集
 *
 *
 */
'use strict';

if(typeof pman   == 'undefined') var pman = {};
/**	カット番号記述をリストに展開
 * 引数を解釈してリスト配列に展開して返す
 *	@params	{String}	name_description
 *	@params {String}	name_template
 *	@params {Boolean}	inherit
 *	
 *	記述リストの不足する情報はname_templateの情報で補う
 *	name_templateは、基準となる識別子をひとつだけ指定する
 *	テンプレートが与えられない場合は第一引数を分解した冒頭の値をテンプレートとして使用する
 *	冒頭から順次処理
 *	主となる第一引数はコンマ","でセパレートしたカット番号記述
 *	範囲表現のハイフン'-'を含んでいて良い
 *	以下のような表現が可能
 *	ABC#01//s-c123-s-c125
 *	s1-c003-25
 *	1-3	これは範囲指定として認識 s1-c3とは解釈されない
 *	s1-c3 明示的にシーン番号として指定することを推奨
 *
 *	シーン指定は出現のたびに切り替わる
 *	タイトル・エピソード・シーンを保持
 *	指定のないエントリは前出の値をコピーする
 *	s1-1-3,s2-c1-35 
 *	これは、以下のように展開される
 *	s1-c1,s1-c2,s1-c3,s2-c1,s2-c2,s2-c3....
 *	アンダーバーは兼用アセットの連結子として予約
 *	s-c1_3_5,2,4,6-10,11_18,12-17
 *	のように記述する
 *	inheritスイッチがtrueの場合は兼用を分解せずに出力する
 *	eg.
 *	pman.expandSCiList("1-3,4_7,5,6,8-10","ABC#01///s-c00001");
 *
 */
pman.expandSCiList = function expandSCiList(name_description,name_template,inherit){
//引数を確認
	if(! name_description) return false;
	if(typeof inherit == 'undefined') inherit = true;
//カンマ分離
	var dataList = name_description.split(",");
	if(name_template){
		var tempData = nas.Pm.parseIdentifier(name_template);
	}else{
		var tempData = nas.Pm.parseIdentifier(dataList[0]);
	}
	var currentScene = tempData.scene;
	var result = [];
	for (var ix = 0 ; ix < dataList.length ; ix ++){
		if(dataList[ix].match(/^(.*\d)\-(.*)$/i)){
			var range = [RegExp.$1,RegExp.$2];
			var startIdf = nas.Pm.parseIdentifier(range[0]);
			var endIdf   = nas.Pm.parseIdentifier(range[1]);
			if(startIdf.scene) currentScene   = startIdf.scene;
//範囲が逆転していたら逆送りで解決する
			var start = nas.parseNumber(startIdf.cut);
			var end   = nas.parseNumber(endIdf.cut);
			if(start > end){
				start = nas.parseNumber(endIdf.cut);
				end   = nas.parseNumber(startIdf.cut);
			};
//識別子を作成してをリザルトに入れる 既存のカットはスキップ
//シーン+ナンバーを
			for(var num = start ; num <= end ; num ++){
				var cname = String(num);
				if (num == start){
					cname = startIdf.cut;
				} else if (num == end){
					cname = endIdf.cut;
				};
				result.add( nas.Pm.stringifyIdf([
					tempData.product.title,
					tempData.product.opus,
					undefined,
					currentScene,
					nas.RZf(cname,3)
				]),function(tgt,dst){
					return (nas.Pm.compareCutIdf(tgt,dst) == 0);
				})
			}
		}else{
			var currentIdf = nas.Pm.parseIdentifier(dataList[ix]);
			if(currentIdf.scene) currentScene   = startIdf.scene;

//			result.add(	nas.Pm.stringifyIdf(currentIdf));
			result.add(	nas.Pm.stringifyIdf([
					tempData.product.title,
					tempData.product.opus,
					"",
					currentScene,
					nas.RZf(currentIdf.cut,3)
				]),function(tgt,dst){
				return (nas.Pm.compareCutIdf(tgt,dst) == 0)
			});// */
		}
	}
	result.sort(nas.Pm.compareCutIdf);
	return result;
}
/*TEST
	pman.expandSCiList("TEST#12__s-c001-TEST#12__s-c12,15,18,20-32");
*/
/**
 *	@params	{String}	targetFolder
 *	@params	{String}	templatePath | template-keyword
 *  @returns	{String}
 *		作成したカットフォルダのフルパスを返す、作成に失敗した場合はエラーメッセージ、またはnull
 *	node.js　が必要？他のライブラリ用の同機能メソッドを作って互換をとる
 
 *	指定のフォルダをひとつ作成する 引数はパス単独
 *	テンプレートフォルダの指定があればそれをターゲットフォルダ名で複製する
 *	テンプレートキーワードならば、定形処理を行う
 *	指定が存在しなければフォルダのみを作成する
 *	
 *	既存のフォルダ(衝突時)は新たに作らない
 *	エラーを戻す?
 *	フォルダ名のみを与えられた場合は、カレントに作成（ターミナル用）
 *		最終的にはRepository.addEntryメソッドの動作として実装する
 */
pman.mkFolder = function mkFolder(targetFolder,templatePath){
//第一引数を確定
	if(!targetFolder) return false;
	if(targetFolder == nas.File.basename(targetFolder)) targetFolder = nas.File.resolve(targetFolder);
//第二引数を確定 _etc/の検索はしない（必要なら指定する）
	switch(templatePath){
	case	"xmap":
	case	"episode":
	case	"title":
	case	"repository":
		templatePath = nas.File.join(
			Folder.current.fsName,"/storage_templates",templatePath
		);
	break;
	default:
		if(fs){
			if(!fs.existsSync(templatePath)) templatePath = null;
		}else if(appHost.platform == 'Electron'){
			if(! electronIpc.existsSync(templatePath)) templatePath = null;
		}else{
			templatePath = null;
		};
	}
//既存パスが指定されている
	if(
		((fs)&&(fs.existsSync(targetFolder)))||
		((appHost.platform == 'Electron')&&(electronIpc.existsSync(targetFolder)))
	) throw targetFolder + ' allready exists !';
	console.log([targetFolder,templatePath]);
//throw 'stop';
	if(templatePath){
		if(fs){
			fs.copyFile(templatePath,targetFolder);
		}else if(appHost.platform == 'Electron'){
			electronIpc.copyFile(templatePath,targetFolder);
		};
	}else{
		if(fs){
			fs.mkdirSync(targetFolder);
			if(! fs.existsSync(targetFolder)) throw '作成失敗';//作成失敗のメッセージ
		}else if(appHost.platform == 'Electron'){
			electronIpc.mkdirSync(targetFolder);
		};
	};
	return targetFolder;
};
/*
		var fd = fs.openSync(nas.File.join(targetFolder,"/__"),"a");//作業タグファイル
		fs.closeSync(fd);
		fs.mkdirSync(nas.File.join(targetFolder,"/_etc"));
		fs.mkdirSync(nas.File.join(targetFolder,"/_movie"));
		fs.mkdirSync(nas.File.join(targetFolder,"/0-0(composite)"));//合成ラインフォルダ
		fs.mkdirSync(nas.File.join(targetFolder,"/1(BGArt)"))      ;//背景美術ラインフォルダ
		fs.mkdirSync(nas.File.join(targetFolder,"/2(3D-CGI)"))     ;//３D-CGIラインフォルダ
		fs.mkdirSync(nas.File.join(targetFolder,"/0__0CT"))        ;//第一工程フォルダ
*/
/*	TEST
	mkFolder("testFolder",null);

 */
/**
 *	@params	{String}	listString
 *			カット番号リスト コンマ区切り
 *	@params {String}	name_tamplate
 *			オプション プロダクト指定
 *	簡易ツール
 *	リスト指定のカットを作成する
 *	作成場所はカレントディレクトリのみ（あらかじめ移動しておくこと）
 *	リストの第一要素でプロダクト指定可能 オプションの指定が優先
 *	未指定の場合、カレントの取得を試みる
 */
pman.mkCutFolders = function mkCutFolders(listString,name_template){
	if(!listString) return false;
	if(!name_template){
		var currentpath = new nas.File(process.cwd());
		name_template = currentpath.body.reverse().find(function(elm){return (elm.indexOf("#") >= 0) });
console.log(name_template.replace(/[\s\(\[].*$/,''));
		if(name_template) name_template = name_template.replace(/[\s\(\[].*$/,'');
	}
	var list = pman.expandSCiList(listString,name_template);
	for(var lix = 0 ; lix < list.length ; lix ++ ){
		mkFolder(list[lix].replace(/\/\//g,"__"),"xmap");
	}
};
///Users/kiyo/Desktop/納品規則/repository(マスターストレージサンプル)/Nekomataya (サンプルレポジトリ)/kt (タイトルフォルダ例)/kt#00 (エピソードフォルダ例)
/*
	mkCutFolders(mash.join(','),"MSH#OP__s-c0001");
	mkCutFolders(cutlist.join(','),"TOS#12__s-c0001");
*/
/**
 * blankのタイムシートデータファイルを作成する
 *	@params	{String}	sciDescription
 *  @returns	{String}
 *		作成したファイルのフルパスを返す、作成に失敗した場合はエラーメッセージ、またはnull
 *	2021現在node.jsが必要
 *	他のライブラリ用の同機能メソッドを作って互換をとる
 */
pman.mkXps = function mkXps(sciDescription,cont){
//第一引数を確定
	if(! sciDescription) return false;
	var resultXps = new Xps();
	resultXps.syncIdentifier(sciDescription,false);
	if(cont){
		resultXps.put
	}
	var fileContent = 	resultXps.toString();
	if(sciDescription == nas.File.basename(sciDescription)) sciDescription = nas.File.resolve(sciDescription);
	sciDescription += '.xpst';
//既存パスが指定されている

//	if(fs.existsSync(sciDescription))	throw sciDescription + ' allready exists !';
	console.log(sciDescription);
//throw 'stop';
	if(fs){
		var fd = fs.openSync(sciDescription,'w');//作業タグファイル
		fs.writeSync(fd,fileContent);
		fs.closeSync(fd);
		if(! fs.existsSync(sciDescription)) throw '作成失敗';//作成失敗のメッセージ
		return sciDescription;
	}else{
		return resultXps;
	}
};
/*
	Xpsオブジェクトを与えて、現在のディレクトリに保存
	ファイル名は Idf固定
	@params    {Object Xps}    sheet
	@returns   {String}
		保存したファイルのフルパス
 */
pman.storeXps = function storeXps(sheet){
//第一引数を確定
	if(!sheet) return false;
	var resultXps = sheet;

	var fileContent    = resultXps.toString();
	var sciDescription = resultXps.getIdentifier('simple');
	if(sciDescription == nas.File.basename(sciDescription)) sciDescription = nas.File.resolve(sciDescription);
	sciDescription += '.xps';

		var fd = fs.openSync(sciDescription,'w');//作業タグファイル
		fs.writeSync(fd,fileContent);
		fs.closeSync(fd);
		if(! fs.existsSync(sciDescription)) throw '作成失敗';//作成失敗のメッセージ
	return sciDescription;
};
/*--------------*/
if(nas.HTML.Console){
	(["mkCutFolders","mkFolder","mkXps","storeXps"]).forEach(function(elm){
		nas.HTML.Console.comlist[elm] = {"command":elm};
	});
};

/*--------------*/
//
var spott =`nasTIME-SHEET 0.5a
##MAPPING_FILE=
##TITLE=MSH
##SUB_TITLE=
##OPUS=OP
##SCENE=
##CUT=spot
##TIME=92+05
##TRIN=0+00,trin
##TROUT=0+00,trout
##CREATE_USER=kiyo@nekomataya.info:
##UPDATE_USER=:
##CREATE_TIME=2021/03/27 23:37:2
##UPDATE_TIME=2021/03/28 16:54:19
##FRAME_RATE=24fps(24)
##Line=(本線):0
##Stage=layout:0
##Job=init:0
##CurrentStatus=Startup
#
#================================================
[sizeX	640	640	640	640	640	640]
[sizeY	480	480	480	480	480	480]
[aspect	1	1	1	1	1	1]
[lot	=AUTO=	=AUTO=	=AUTO=	=AUTO=	=AUTO=	=AUTO=]
[blmtd	file	file	file	file	file	file]
[blpos	end	end	end	end	end	end]
[option	dialog	dialog	timing	timing	timing	comment]
[link	.	.	.	.	.	.]
[tag						]
[CELL	N	N1	A	B	C	]
[value						]
#================================================
.						s-c001
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	●	<♪>				
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*					
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	*	<♪>				
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	●	<♪>				
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	*					
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	*	<♪>				
.						
#================================================
.						s-c002
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	●	<♪>				
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	*					
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	*					
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	●					
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	*	<♪>				
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*					
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	●	<♪>				
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	*					
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	*	<♪>				
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	●					
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						s-c003
#------------------------------------------------
.						
.	*	<♪>				
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	*					
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	●					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	*	<♪>				
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	*					
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	*					
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	●					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*	<♪>				
.						
.						
.						
.						
#================================================
.						
.						
.						
.						s-c004
.						
.	*					
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	●					
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	*	<♪>				
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	*					
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	●	<♪>				
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	*					
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*	<♪>				
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						s-c005
#================================================
.						
.						
.	*	<♪>				
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						s-c006
#------------------------------------------------
.	●	<♪>				
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	*	<♪>				
.						s-c007
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.		<♪>				
.	*					
.						
.						s-c008
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*	<♪>				
.						
.						
.						
.						s-c009
#================================================
.						
.						
.						
.						
.						
.	●	<♪>				
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*	<♪>				
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	*	<♪>				
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	*					
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	●	<♪>				
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*	<♪>				
.						s-c010
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	*					
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	●					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	*					
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	*					
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	*					
.						
#================================================
.						
.						
.						
.						
.						
.						s-c011
#------------------------------------------------
.						
.						
.						
.	●					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*	<♪>				
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	*					
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						s-c012
.						
.						
#================================================
.						
.						
.	●					
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	*	<♪>				
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	*					
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	●					
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	*	<♪>				
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	*					
.						
.						
.						
#------------------------------------------------
.						s-c013
.						
.						
.						
.						
.						
#------------------------------------------------
.	●					
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	*					
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*					
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	●					
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*	<♪>				
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	*					
.						s-c014
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	*					
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	●					
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*					
.						
.						s-c015
.						
.						
#================================================
.						
.						
.						
.						
.						
.	*					
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	●					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						s-c016
#================================================
.						
.						
.	*					
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	*	<♪>				
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	*					
.						s-c017
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	●					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*					
.						
.						
.						
.						s-c018
#================================================
.						
.						
.						
.						
.						
.	*					
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						s-c019
#================================================
.						
.						
.	●					
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	*	<♪>				
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	*					
.						
#================================================
.						
.						
.						s-c020
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	●					
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	*					
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	*					s-c021
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	●					
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	*					
.						
#================================================
.						
.						
.						s-c022
.						
.						
.						
#------------------------------------------------
.						
.						
.		<♪>				
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*					
.						
.						
.						
.						
#================================================
.						
.						
.						s-c023
.						
.						
.	●					
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	*					
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	*					
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	●					
.						
#================================================
.						
.						
.						s-c024
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*	<♪>				
.						
.						
.						
.						
#================================================
.						
.						
.						s-c025
.						
.						
.	*					
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	●					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	*					
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	*					
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	*					s-c026
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	●					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*					
.						
.						
.						s-c027
.						
#================================================
.						
.						
.						
.						
.						
.	*	<♪>				
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*	<♪>				
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	●					s-c028
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	*					
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	*	<♪>				
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						s-c029
.						
.						
.						
#------------------------------------------------
.						
.	●	<♪>				
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	*					
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*	<♪>				
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	*					
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						s-c030
#------------------------------------------------
.	●					
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	*					
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*					
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	●					
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	*	<♪>				
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						s-c031
.						
#------------------------------------------------
.	*					
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	●					
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*	<♪>				
.						
.						
.						s-c032
.						
#================================================
.						
.						
.						
.						
.						
.	*					
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	●					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	*					
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	*					
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	*					s-c033
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	●					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*					
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	*	<♪>				
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*	<♪>				
.						s-c034
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	●	<♪>				s-c035
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	*	<♪>				
.						
.						
.						
.						s-c036
.						
#------------------------------------------------
.						
.						
.						
.						
.	*	<♪>				
.						
#================================================
.						
.						
.						s-c037
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						s-c038
.						
#------------------------------------------------
.						
.	●					
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	*					
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						s-c039
.						
.	*					
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	●					
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	*	<♪>				
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						s-c040
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*					
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	●	<♪>				
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						s-c041
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	*					
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	*					
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	●					
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*					
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	*	<♪>				
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	●					
.						s-c042
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	*					
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	*	<♪>				
.						
.						
.						
.						s-c043
.						
#------------------------------------------------
.						
.						
.						
.						
.	*					
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	●					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*					
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	*					
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	●					
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	*					
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	*					
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	●					
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	*					
#------------------------------------------------
.						s-c044
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	*					
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	●	<♪>				
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	*					
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						s-c045
.						
.		<♪>				
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*					
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	●	<♪>				
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	*					
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						s-c046
.						
#------------------------------------------------
.	*	<♪>				
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	●					
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*					
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	*					
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	●					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	*					
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	*	<♪>				
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						s-c047
.						
.						
.	*	<♪>				
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.		<♪>				
.	●					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*	<♪>				
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	*	<♪>				
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	●					
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	*					
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	*					
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	●					
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	*					
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	*					
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.	●					
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.	*					
.						
#================================================
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.	*					
.						
.						
.						
.						
#================================================
.						
.						
.						
.						
.						
.	●					
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#------------------------------------------------
.						
.						
.						
.	*					
.						
.						
#------------------------------------------------
.						
.						
.						
.						
.						
.						
#================================================
.						
.						
.	*					
.						
.						
#================================================
[END]`;

var cutlist = ["M#PV__s1-c19\(3+0\)","M#PV__s1-c20\(6+0\)","M#PV__s3-c5_7\(8+6\)","M#PV__s3-c11A\(1+22\)","M#PV__s3-c13\(1+12\)","M#PV__s3-c14B\(2+0\)","M#PV__s3-c15A\(4+12\)","M#PV__s3-c15C\(8+6\)","M#PV__s3-c16\(0+14\)","M#PV__s3-c17\(0+18\)","M#PV__s3-c18\(2+0\)","M#PV__s3-c19\(3+18\)","M#PV__s3-c20\(4+0\)","M#PV__s3-c23\(1+12\)","M#PV__s3-c24\(1+12\)","M#PV__s3-c25\(4+0\)","M#PV__s3-c26\(3+0\)"];

/*
["M#PV__s-c010\(2+9\)","M#PV__s-c011\(1+16\)","M#PV__s-c012\(3+9\)","M#PV__s-c013\(2+21\)","M#PV__s-c014\(1+18\)","M#PV__s-c015\(1+2\)","M#PV__s-c016\(1+0\)","M#PV__s-c017\(1+0\)","M#PV__s-c018\(1+0\)","M#PV__s-c019\(1+3\)","M#PV__s-c020\(2+0\)","M#PV__s-c021\(1+0\)","M#PV__s-c022\(1+0\)","M#PV__s-c023\(2+0\)","M#PV__s-c024\(1+0\)","M#PV__s-c025\(1+20\)","M#PV__s-c026\(1+0\)","M#PV__s-c027\(1+4\)","M#PV__s-c028\(1+12\)","M#PV__s-c029\(1+12\)","M#PV__s-c030\(2+23\)","M#PV__s-c031\(1+12\)","M#PV__s-c032\(2+0\)","M#PV__s-c033\(1+18\)","M#PV__s-c034\(0+10\)","M#PV__s-c035\(0+14\)","M#PV__s-c036\(0+10\)","M#PV__s-c037\(0+14\)","M#PV__s-c038\(1+8\)","M#PV__s-c039\(1+8\)","M#PV__s-c040\(1+8\)","M#PV__s-c041\(3+0\)","M#PV__s-c042\(1+0\)","M#PV__s-c043\(4+14\)","M#PV__s-c044\(2+0\)","M#PV__s-c045\(2+4\)","M#PV__s-c046\(3+9\)","M#PV__s-c047\(8+10\)"];
*/

/*

var spotXps = new Xps();
spotXps.parseXps(spott);

var currentFrame = 0;
var currentDuration = 0;
var margin = 6;//6フレームマージン

for (var ct = 0 ; ct < mash.length ; ct ++){
console.log(mash[ct]);
	var props = Xps.parseIdentifier(mash[ct]);
console.log(props);
	currentDuration = nas.FCT2Frm(props.time);

var stfr  = (currentFrame - margin)+ margin;
var endfr = currentFrame + currentDuration + margin;

	currentXps = new Xps();
	currentXps.syncIdentifier(mash[ct]);
	currentXps.subtitle = '';
	currentXps.setDuration(currentDuration+12);
	
	currentXps.put([0,0],spotXps.getRange([[0,stfr],[2,endfr]]));
		console.log(storeXps(currentXps));
	currentFrame += currentDuration;
};// */

/*
for (var ct = 0 ; ct < mash.length ; ct ++){
	mkXps(mash[ct]);
}
*/
